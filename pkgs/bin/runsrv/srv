#!/bin/sh

cd /var/run

mkdir -p ${1}
cd ${1}

shift

PP=$$
P=/sys/fs/cgroup/${PP}

(
set -xue

date
mkdir ${P}

echo ${PP} > ${P}/cgroup.procs

cleanup() (
    echo 1 > ${P}/cgroup.kill
)

trap cleanup TERM INT EXIT

flock lock $@ &

wait
) 1>>out 2>>out
